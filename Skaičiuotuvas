from flask import Flask, request
from PIL import Image, ImageDraw, ImageFont
import os

app = Flask(__name__)

def sudetis(x, y):
    return x + y

def atimtis(x, y):
    return x - y

def daugyba(x, y):
    return x * y

def dalyba(x, y):
    if y != 0:
        return x / y
    else:
        return "Dalyba iš nulio negalima"

def generate_image(result, animal):
    if animal.lower() == 'katė':
        image_path = "static/result_images/Kate.png"
    elif animal.lower() == 'šuo':
        image_path = "static/result_images/suo.jpg"
    else:
        return None

    image = Image.open(image_path)
    draw = ImageDraw.Draw(image)
    font = ImageFont.truetype("arial.ttf", 36)
    draw.text((50, 20), str(result), fill=(0, 0, 0), font=font)  # Tekstas juodos spalvos
    result_image_path = f"static/result_images/result_{animal.lower()}.jpg"
    image.save(result_image_path)
    
    return result_image_path

@app.route("/")
def hello_world():
    return """
    <form action="/skaicius">
        <label for="test">Įrašykite pirmą skaičių</label><br>
        <input type="text" id="test" name="test" value=" "><br><br>

        <label for="test2">Įrašykite antrą skaičių</label><br>
        <input type="text" id="test2" name="test2" value=" "><br><br>

        <label for="veiksmas">Palikite vieną norimo atlikti matematinio veiksmo ženklą </label><br>   
        <input type="text" id="veiksmas" name="veiksmas" value="+-*/"><br><br> 

        <label for="gyvunas">Pasirinkite, koks gyvūnas jums labiau patinka (katė ar šuo)</label><br>   
        <input type="text" id="gyvunas" name="gyvunas" value="katė/šuo"><br><br>   
        
        <input type="submit" value="Skaičiuoti">
    </form>
    """

@app.route("/skaicius")
def skaiciuoti():
    if not request.args.get("test") or not request.args.get("test2"):
        return "Nera argumento"

    skaicius = request.args.get("test")
    skaicius2 = request.args.get("test2")
    operacija = request.args.get("veiksmas")
    gyvunas = request.args.get("gyvunas")

    if operacija == '+':
        suma = sudetis(int(skaicius), int(skaicius2))
        result_image_path = generate_image(suma, gyvunas)
        return f'<img src="{result_image_path}" alt="Rezultatas">'
    elif operacija == '-':
        skirtumas = atimtis(int(skaicius), int(skaicius2))
        result_image_path = generate_image(skirtumas, gyvunas)
        return f'<img src="{result_image_path}" alt="Rezultatas">'
    elif operacija == '*':
        sandauga = daugyba(int(skaicius), int(skaicius2))
        result_image_path = generate_image(sandauga, gyvunas)
        return f'<img src="{result_image_path}" alt="Rezultatas">'
    elif operacija == '/':
        dalmuo = dalyba(int(skaicius), int(skaicius2))
        result_image_path = generate_image(dalmuo, gyvunas)
        return f'<img src="{result_image_path}" alt="Rezultatas">'
    else:
        return "Jūsų matematinis ženklas neatitinka reikalavimų, bandykite iš naujo"

if __name__ == "__main__":
    app.run()
